package br.com.ecoffee.validation.cliente;

import java.util.Optional;

import org.springframework.stereotype.Service;

import br.com.ecoffee.dto.cliente.AtualizarClienteForm;
import br.com.ecoffee.exception.UniqueException;
import br.com.ecoffee.model.cliente.Cliente;
import br.com.ecoffee.service.cliente.ClienteService;

@Service
public class ClienteValidation {
	
	private ClienteService clienteService;
	
	public ClienteValidation(ClienteService clienteService) {
		this.clienteService = clienteService;
	}

	public void validarEmailECpf(Cliente cliente) {
		
		if(clienteService.buscarClientePeloEmail(cliente.getEmail()).isPresent()) {
			throw new UniqueException("E-mail já utilizado, por favor tente outro!", "email");
		}
		if(clienteService.buscarClientePeloCpf(cliente.getCpf()).isPresent()) {
			throw new UniqueException("Por favor tente outro CPF!", "cpf");
		}
		
	}

	public void validarAtualizacaoEmailECpf(Cliente cliente, AtualizarClienteForm clienteForm) {
		
		Optional<Cliente> emailCliente = clienteService.buscarClientePeloEmail(clienteForm.getEmail());
		Optional<Cliente> cpfCliente = clienteService.buscarClientePeloCpf(clienteForm.getCpf());
		
		if(emailCliente.isPresent() && emailCliente.get().getIdCliente() != cliente.getIdCliente()) {
			throw new UniqueException("E-mail já utilizado, por favor tente outro!", "email");
		}
		if(cpfCliente.isPresent() && cpfCliente.get().getIdCliente() != cliente.getIdCliente()) {
			throw new UniqueException("Por favor tente outro CPF!", "cpf");
		}
		
	}

}
